<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0071e3">
    <title>Criar Conte√∫do | ConversaLearn</title>

    <!-- Apple-style Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Main Stylesheet - Apple Design System -->
    <link rel="stylesheet" href="styles.css">

    <style>
        /* Page-specific styles for content-creator.html */

        .char-counter {
            font-variant-numeric: tabular-nums;
            font-size: 14px;
            color: var(--color-text-secondary);
            font-weight: 500;
        }

        .char-counter.warning {
            color: var(--moz-red);
        }

        textarea {
            font-family: inherit;
            width: 100%;
            padding: var(--spacing-sm);
            border: 2px solid var(--color-bg-secondary);
            border-radius: var(--radius-md);
            font-size: 16px;
            line-height: 1.6;
            resize: vertical;
            transition: all var(--transition);
        }

        textarea:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
        }

        .creator-nav {
            background: var(--moz-green);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .creator-nav a {
            color: white;
            text-decoration: none;
            transition: opacity var(--transition);
        }

        .creator-nav a:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body style="background: var(--color-bg-secondary);">

    <!-- Navigation -->
    <nav class="creator-nav">
        <div class="container" style="max-width: 1400px;">
            <div style="display: flex; justify-content: space-between; align-items: center; height: 72px;">
                <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                    <div style="width: 40px; height: 40px; background: white; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 22px;">
                        ‚úù
                    </div>
                    <h1 style="color: white; font-size: clamp(20px, 3vw, 28px); font-weight: 600;">
                        Criar Conte√∫do
                    </h1>
                </div>
                <div>
                    <a href="index.html" style="font-size: 16px; font-weight: 500;">
                        ‚Üê Voltar
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container" style="max-width: 1000px; padding-top: var(--spacing-xl); padding-bottom: var(--spacing-xl);">

        <!-- Header Info -->
        <div class="card" style="margin-bottom: var(--spacing-lg);">
            <h2 style="margin-bottom: var(--spacing-sm);">‚úçÔ∏è Criar Sua Pr√≥pria Li√ß√£o</h2>
            <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                Cole seu texto abaixo e transforme em uma li√ß√£o conversacional!
                O conte√∫do ser√° salvo no seu navegador e usado no webapp.
            </p>
            <div style="background: var(--moz-yellow); padding: var(--spacing-sm); border-radius: var(--radius-sm); display: inline-block;">
                <p style="font-weight: 600; font-size: 15px;">üìù M√°ximo: 10000 caracteres | üíæ Salvo automaticamente</p>
            </div>
        </div>

        <!-- Alert -->
        <div id="alert" style="display: none; margin-bottom: var(--spacing-md);"></div>

        <!-- Text Input Section -->
        <div class="card" style="margin-bottom: var(--spacing-lg);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                <h3>Seu Conte√∫do</h3>
                <div class="char-counter">
                    <span id="charCount">0</span> / 10000
                </div>
            </div>

            <textarea id="userContent"
                style="height: 400px; font-family: 'SF Mono', 'Monaco', 'Courier New', monospace; font-size: 14px;"
                placeholder="Cole seu texto aqui...

Exemplo:

LI√á√ÉO: Minha Primeira Li√ß√£o
TEMPO: 3 minutos

[GANCHO]
Uma pergunta interessante que desperta curiosidade...
Mais contexto sobre essa pergunta
BOT√ÉO: Vamos descobrir!

[CONCEITO]
Aqui voc√™ explica o conceito principal
Use **negrito** para destacar palavras-chave
Pode usar emojis tamb√©m! üí°
BOT√ÉO: Entendi!
PONTOS: 5

[QUIZ]
PERGUNTA: Qual a resposta correta?
A) Primeira op√ß√£o | CORRETO | Parab√©ns! Voc√™ acertou! üéâ
B) Segunda op√ß√£o | ERRADO | Tente novamente! üí™
C) Terceira op√ß√£o | ERRADO | Quase l√°! Continue tentando! üí°
PONTOS_CORRETO: 10
PONTOS_ERRADO: 2

[REFOR√áO]
Parab√©ns! Voc√™ completou a li√ß√£o! üéä
Continue assim e voc√™ vai longe!
BOT√ÉO: Finalizar
PONTOS_BONUS: 20" maxlength="10000"></textarea>

            <div style="margin-top: var(--spacing-md); display: flex; flex-wrap: wrap; gap: var(--spacing-sm);">
                <button onclick="clearContent()" class="btn" style="background: var(--color-bg-secondary); color: var(--color-text-primary);">
                    üóëÔ∏è Limpar
                </button>
                <button onclick="loadExample()" class="btn" style="background: var(--moz-yellow); color: var(--color-text-primary);">
                    üìÑ Carregar Exemplo
                </button>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="card" style="margin-bottom: var(--spacing-lg);">
            <h3 style="margin-bottom: var(--spacing-md);">üëÅÔ∏è Preview JSON</h3>
            <pre id="jsonPreview"
                style="background: var(--color-text-primary); color: #4ade80; padding: var(--spacing-md); border-radius: var(--radius-md); font-family: 'SF Mono', 'Monaco', 'Courier New', monospace; font-size: 12px; overflow-x: auto; height: 320px; overflow-y: auto; line-height: 1.6;">
// Cole texto acima e veja o JSON gerado aqui...
            </pre>
        </div>

        <!-- Actions -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
            <button onclick="saveToCache()" class="btn" style="background: var(--moz-green); color: white; padding: var(--spacing-md); font-size: 18px; font-weight: 600;">
                üíæ Salvar no Cache
            </button>
            <button onclick="testInApp()" class="btn" style="background: var(--moz-red); color: white; padding: var(--spacing-md); font-size: 18px; font-weight: 600;">
                üöÄ Testar no WebApp
            </button>
        </div>

        <!-- Cache Status -->
        <div style="background: var(--color-text-primary); color: white; border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--shadow-md);">
            <h3 style="color: white; margin-bottom: var(--spacing-md);">üìä Status do Cache</h3>
            <div id="cacheStatus" style="font-family: 'SF Mono', 'Monaco', 'Courier New', monospace; font-size: 14px; line-height: 1.6;">
                Verificando...
            </div>
            <button onclick="clearCache()" class="btn" style="margin-top: var(--spacing-md); background: var(--moz-red); color: white;">
                üóëÔ∏è Limpar Cache
            </button>
        </div>

    </div>

    <script>
        const textarea = document.getElementById('userContent');
        const charCount = document.getElementById('charCount');
        const jsonPreview = document.getElementById('jsonPreview');
        const cacheStatus = document.getElementById('cacheStatus');

        // Update character count
        textarea.addEventListener('input', () => {
            const count = textarea.value.length;
            charCount.textContent = count;

            if (count > 9000) {
                charCount.parentElement.classList.add('warning');
            } else {
                charCount.parentElement.classList.remove('warning');
            }

            // Auto-generate preview
            generatePreview();
        });

        // Generate JSON Preview
        function generatePreview() {
            const text = textarea.value.trim();

            if (!text) {
                jsonPreview.textContent = '// Cole texto acima e veja o JSON gerado aqui...';
                return;
            }

            try {
                const json = textToJSON(text);
                jsonPreview.textContent = JSON.stringify(json, null, 2);
            } catch (error) {
                jsonPreview.textContent = `// Erro: ${error.message}`;
            }
        }

        // Convert text to JSON
        function textToJSON(text) {
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);

            const lesson = {
                id: "custom-lesson-" + Date.now(),
                title: "",
                estimatedTime: "3 minutos",
                drops: []
            };

            let i = 0;
            while (i < lines.length) {
                const line = lines[i];

                if (line.startsWith('LI√á√ÉO:')) {
                    lesson.title = line.replace('LI√á√ÉO:', '').trim();
                } else if (line.startsWith('TEMPO:')) {
                    lesson.estimatedTime = line.replace('TEMPO:', '').trim();
                } else if (line.startsWith('[GANCHO]')) {
                    const result = parseSection(lines, i + 1, 'gancho');
                    lesson.drops.push(result.drop);
                    i = result.nextIndex - 1;
                } else if (line.startsWith('[CONCEITO]')) {
                    const result = parseSection(lines, i + 1, 'conceito');
                    lesson.drops.push(result.drop);
                    i = result.nextIndex - 1;
                } else if (line.startsWith('[QUIZ]') || line.startsWith('[A√á√ÉO]')) {
                    const type = line.startsWith('[QUIZ]') ? 'reflexao' : 'acao';
                    const result = parseQuiz(lines, i + 1, type);
                    lesson.drops.push(result.drop);
                    i = result.nextIndex - 1;
                } else if (line.startsWith('[REFOR√áO]')) {
                    const result = parseSection(lines, i + 1, 'reforco');
                    lesson.drops.push(result.drop);
                    i = result.nextIndex - 1;
                }

                i++;
            }

            return lesson;
        }

        function parseSection(lines, startIndex, type) {
            const messages = [];
            let button = 'Continuar';
            let xp = 5;
            let bonusXP = 20;
            let i = startIndex;

            while (i < lines.length && !lines[i].startsWith('[')) {
                const line = lines[i];

                if (line.startsWith('BOT√ÉO:')) {
                    button = line.replace('BOT√ÉO:', '').trim();
                } else if (line.startsWith('PONTOS:')) {
                    xp = parseInt(line.replace('PONTOS:', '').trim());
                } else if (line.startsWith('PONTOS_BONUS:')) {
                    bonusXP = parseInt(line.replace('PONTOS_BONUS:', '').trim());
                } else if (line) {
                    messages.push(line);
                }

                i++;
            }

            const drop = {
                type: type,
                sender: "professor",
                messages: messages.map((msg, idx) => ({
                    text: msg,
                    delay: idx * 1500
                })),
                interaction: {
                    type: type === 'reforco' ? 'complete' : 'continue',
                    button: button
                }
            };

            if (type !== 'reforco' && type !== 'gancho') {
                drop.xp = xp;
            }

            if (type === 'reforco') {
                drop.interaction.bonusXP = bonusXP;
            }

            return { drop, nextIndex: i };
        }

        function parseQuiz(lines, startIndex, type) {
            const messages = [];
            let question = '';
            const options = [];
            let xpCorrect = 10;
            let xpIncorrect = 2;
            let i = startIndex;

            while (i < lines.length && !lines[i].startsWith('[')) {
                const line = lines[i];

                if (line.startsWith('PERGUNTA:')) {
                    question = line.replace('PERGUNTA:', '').trim();
                } else if (line.startsWith('PONTOS_CORRETO:')) {
                    xpCorrect = parseInt(line.replace('PONTOS_CORRETO:', '').trim());
                } else if (line.startsWith('PONTOS_ERRADO:')) {
                    xpIncorrect = parseInt(line.replace('PONTOS_ERRADO:', '').trim());
                } else if (line.match(/^[ABC]\)/)) {
                    const parts = line.split('|').map(p => p.trim());
                    const optionText = parts[0].substring(3).trim();
                    const isCorrect = parts[1] === 'CORRETO';
                    const feedback = parts[2];

                    options.push({
                        id: parts[0][0].toLowerCase(),
                        text: optionText,
                        correct: isCorrect,
                        feedback: feedback
                    });
                } else if (line && !line.startsWith('PERGUNTA:')) {
                    messages.push(line);
                }

                i++;
            }

            const drop = {
                type: type,
                sender: "professor",
                messages: messages.map((msg, idx) => ({
                    text: msg,
                    delay: idx * 1000
                })),
                interaction: {
                    type: "quiz",
                    question: question || "Escolha a op√ß√£o correta:",
                    options: options,
                    xpCorrect: xpCorrect,
                    xpIncorrect: xpIncorrect
                }
            };

            return { drop, nextIndex: i };
        }

        // Save to Cache
        function saveToCache() {
            const text = textarea.value.trim();

            if (!text) {
                showAlert('‚ùå Cole algum texto primeiro!', 'error');
                return;
            }

            if (text.length > 10000) {
                showAlert('‚ùå Texto muito longo! M√°ximo: 10000 caracteres', 'error');
                return;
            }

            try {
                const json = textToJSON(text);
                const fullContent = {
                    courses: [{
                        id: "custom-course",
                        title: "Meu Conte√∫do Personalizado",
                        description: "Conte√∫do criado por voc√™",
                        lessons: [json]
                    }],
                    metadata: {
                        version: "1.0",
                        schema: "conversational-learning",
                        custom: true,
                        createdAt: new Date().toISOString()
                    }
                };

                localStorage.setItem('conversalearn-custom-content', JSON.stringify(fullContent));
                showAlert('‚úÖ Conte√∫do salvo com sucesso no cache!', 'success');
                updateCacheStatus();
            } catch (error) {
                showAlert('‚ùå Erro ao salvar: ' + error.message, 'error');
            }
        }

        // Test in App
        function testInApp() {
            saveToCache();
            setTimeout(() => {
                window.location.href = 'webapp.html';
            }, 1000);
        }

        // Clear Content
        function clearContent() {
            if (confirm('Limpar todo o conte√∫do?')) {
                textarea.value = '';
                charCount.textContent = '0';
                generatePreview();
            }
        }

        // Load Example
        function loadExample() {
            textarea.value = `LI√á√ÉO: O Amor de Deus
TEMPO: 3 minutos

[GANCHO]
Voc√™ j√° parou para pensar: quanto Deus te ama? üíô
A resposta pode surpreender voc√™!
BOT√ÉO: Quero saber!

[CONCEITO]
A B√≠blia diz: **"Porque Deus amou o mundo de tal maneira que deu o seu Filho"** (Jo√£o 3:16)
Deus n√£o apenas diz que te ama. Ele PROVOU com a√ß√£o! ‚úùÔ∏è
Enquanto ainda √©ramos pecadores, Cristo morreu por n√≥s.
BOT√ÉO: Que amor incr√≠vel!
PONTOS: 5

[QUIZ]
PERGUNTA: Como Deus demonstrou Seu amor?
A) Enviando Jesus para morrer por n√≥s | CORRETO | Exatamente! Esse √© o maior ato de amor da hist√≥ria! üéâ
B) Apenas dizendo palavras bonitas | ERRADO | O amor de Deus √© a√ß√£o, n√£o s√≥ palavras! Releia Jo√£o 3:16 üí°
C) Dando bens materiais | ERRADO | O maior presente foi Jesus, n√£o coisas! üíô
PONTOS_CORRETO: 10
PONTOS_ERRADO: 2

[REFOR√áO]
Voc√™ completou esta li√ß√£o! üéä
Nunca esque√ßa: Deus te ama tanto que deu Jesus!
Isso muda tudo! üíô‚úùÔ∏è
BOT√ÉO: Am√©m!
PONTOS_BONUS: 20`;

            charCount.textContent = textarea.value.length;
            generatePreview();
            showAlert('üìÑ Exemplo carregado! Edite como quiser.', 'info');
        }

        // Clear Cache
        function clearCache() {
            if (confirm('Limpar conte√∫do salvo no cache? Isso N√ÉO apaga o texto atual.')) {
                localStorage.removeItem('conversalearn-custom-content');
                showAlert('üóëÔ∏è Cache limpo! O webapp usar√° o conte√∫do padr√£o.', 'info');
                updateCacheStatus();
            }
        }

        // Update Cache Status
        function updateCacheStatus() {
            const cached = localStorage.getItem('conversalearn-custom-content');

            if (cached) {
                try {
                    const data = JSON.parse(cached);
                    const size = new Blob([cached]).size;
                    const created = new Date(data.metadata.createdAt).toLocaleString('pt-BR');

                    cacheStatus.innerHTML = `
                        ‚úÖ <strong>Conte√∫do personalizado salvo</strong><br>
                        üì¶ Tamanho: ${size} bytes<br>
                        üìÖ Criado em: ${created}<br>
                        üìö Li√ß√£o: "${data.courses[0].lessons[0].title}"<br>
                        <span class="text-green-400">O webapp usar√° este conte√∫do!</span>
                    `;
                } catch (error) {
                    cacheStatus.innerHTML = '‚ö†Ô∏è Cache corrompido. Limpe e tente novamente.';
                }
            } else {
                cacheStatus.innerHTML = `
                    ‚ÑπÔ∏è Nenhum conte√∫do personalizado salvo.<br>
                    O webapp usar√° o conte√∫do padr√£o (Fundamentos da F√©).
                `;
            }
        }

        // Show Alert
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            const colors = {
                success: 'bg-moz-green text-white',
                error: 'bg-moz-red text-white',
                info: 'bg-moz-yellow text-black'
            };

            alert.className = `${colors[type]} border-4 border-black neo-brutal p-4 mb-6`;
            alert.textContent = message;
            alert.classList.remove('hidden');

            setTimeout(() => {
                alert.classList.add('hidden');
            }, 4000);
        }

        // Initialize
        updateCacheStatus();
        generatePreview();
    </script>

</body>

</html>